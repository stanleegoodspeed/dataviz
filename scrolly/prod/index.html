<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Builders Data Viz</title>
  <meta name="description" content="Builders Data Viz" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://s3.amazonaws.com/colincole.me/dataviz/css/style.css" />
</head>

<body>
  <main>

    <!-- Scrolly -->
    <section id="scrolly">
      <figure>
        <div id="my_dataviz_0" class="dataviz is-active"></div>
        <div id="my_dataviz_1" class="dataviz"></div>
        <div id="my_dataviz_2" class="dataviz"></div>
        <div id="my_dataviz_3" class="dataviz"></div>
      </figure>
      <article>
        <div class="step is-active" data-step="1">
          <div class="step-container">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a aliquam purus. Mauris ut magna in libero
              pulvinar efficitur nec vel mauris. Nullam facilisis sem non ante lacinia pellentesque. Aenean a nunc mattis,
              auctor enim sit amet, ornare ipsum.</p>
          </div>
        </div>
        <div class="step" data-step="2">
          <div class="step-container">
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a aliquam purus.Nullam facilisis sem non
            ante lacinia pellentesque. Aenean a nunc mattis, auctor enim sit amet, ornare ipsum.</p>
          </div>
        </div>
        <div class="step" data-step="3">
          <div class="step-container">
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a aliquam purus. Nullam facilisis sem non
            ante lacinia pellentesque.</p>
          </div>
        </div>
        <div class="step" data-step="4">
          <div class="step-container">
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a aliquam purus. Mauris ut magna in libero
            pulvinar efficitur nec vel mauris. Nullam facilisis sem non ante lacinia pellentesque. Aenean a nunc mattis,
            auctor enim sit amet, ornare ipsum. Mauris ut magna in libero pulvinar efficitur nec vel mauris</p>
          </div>
        </div>
      </article>
    </section>
  </main>

  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
  <script src="https://s3.amazonaws.com/colincole.me/dataviz/js/stickyfill.min.js"></script>
  <script src="https://s3.amazonaws.com/colincole.me/dataviz/js/scrollama.min.js"></script>
  <script src="https://s3.amazonaws.com/colincole.me/dataviz/js/chart-builder.js"></script>
  <script>
    // using d3 for convenience
    var main = d3.select("main");
    var scrolly = main.select("#scrolly");
    var figure = scrolly.select("figure");
    var article = scrolly.select("article");
    var step = article.selectAll(".step");
    var dataViz = figure.selectAll(".dataviz");

    // initialize the scrollama
    var scroller = scrollama();

    // generic window resize listener event
    function handleResize() {
      // 1. update height of step elements
      var stepH = Math.floor(window.innerHeight * 0.75);
      step.style("height", stepH + "px");

      var figureHeight = window.innerHeight / 2;
      var figureMarginTop = (window.innerHeight - figureHeight) / 2;

      figure
        .style("height", figureHeight + "px")
        .style("top", figureMarginTop + "px");

      // 3. tell scrollama to update new element dimensions
      scroller.resize();
    }

    // scrollama event handlers
    function handleStepEnter(response) {
      // response = { element, direction, index }

      // add color to current step only
      step.classed("is-active", function (d, i) {
        return i === response.index;
      });

      dataViz.classed("is-active", function (d, i) {
        return i === response.index;
      });

      //var activeDataViz = figure.select(`#my_dataviz_${response.index}`);
      //activeDataViz.classed("is-active",true);
    }

    function setupStickyfill() {
      d3.selectAll(".sticky").each(function () {
        Stickyfill.add(this);
      });
    }

    function init() {
      setupStickyfill();

      // 1. force a resize on load to ensure proper dimensions are sent to scrollama
      handleResize();

      // 2. setup the scroller passing options
      // 		this will also initialize trigger observations
      // 3. bind scrollama event handlers (this can be chained like below)
      scroller
        .setup({
          step: "#scrolly article .step",
          offset: 0.33,
          debug: false
        })
        .onStepEnter(handleStepEnter);

      // setup resize event
      window.addEventListener("resize", handleResize);
    }

    // kick things off
    init();
  </script>
</body>

</html>